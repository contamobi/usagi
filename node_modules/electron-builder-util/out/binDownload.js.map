{
  "version": 3,
  "file": "binDownload.js",
  "sourceRoot": "",
  "sources": [
    "../src/binDownload.ts"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import { spawn, debug, debug7zArgs, getTempName, getCacheDirectory } from \"./util\"\nimport { rename, unlink, emptyDir } from \"fs-extra-p\"\nimport { path7za } from \"7zip-bin\"\nimport * as path from \"path\"\nimport BluebirdPromise from \"bluebird-lst-c\"\nimport { statOrNull } from \"./fs\"\nimport { httpExecutor } from \"./nodeHttpExecutor\"\nimport { CancellationToken } from \"electron-builder-http/out/CancellationToken\"\n\nconst versionToPromise = new Map<string, BluebirdPromise<string>>()\n\nexport function getBinFromBintray(name: string, version: string, sha2: string): Promise<string> {\n  const dirName = `${name}-${version}`\n  return getBin(name, dirName, `https://dl.bintray.com/electron-userland/bin/${dirName}.7z`, sha2)\n}\n\nexport function getBin(name: string, dirName: string, url: string, sha2: string): Promise<string> {\n  let promise = versionToPromise.get(dirName)\n  // if rejected, we will try to download again\n  if (promise != null && !promise.isRejected()) {\n    return promise\n  }\n\n  promise = <BluebirdPromise<string>>doGetBin(name, dirName, url, sha2)\n  versionToPromise.set(dirName, promise)\n  return promise\n}\n\n// we cache in the global location - in the home dir, not in the node_modules/.cache (https://www.npmjs.com/package/find-cache-dir) because\n// * don't need to find node_modules\n// * don't pollute user project dir (important in case of 1-package.json project structure)\n// * simplify/speed-up tests (don't download fpm for each test project)\nasync function doGetBin(name: string, dirName: string, url: string, sha2: string): Promise<string> {\n  const cachePath = path.join(getCacheDirectory(), name)\n  const dirPath = path.join(cachePath, dirName)\n\n  const dirStat = await statOrNull(dirPath)\n  //noinspection ES6MissingAwait\n  if (dirStat != null && dirStat.isDirectory()) {\n    debug(`Found existing ${name} ${dirPath}`)\n    return dirPath\n  }\n\n  // 7z cannot be extracted from the input stream, temp file is required\n  const tempUnpackDir = path.join(cachePath, getTempName())\n  const archiveName = `${tempUnpackDir}.7z`\n  debug(`Download ${name} from ${url} to ${archiveName}`)\n  // 7z doesn't create out dir, so, we don't create dir in parallel to download - dir creation will create parent dirs for archive file also\n  await emptyDir(tempUnpackDir)\n  await httpExecutor.download(url, archiveName, {\n    skipDirCreation: true,\n    sha2: sha2,\n    cancellationToken: new CancellationToken(),\n  })\n\n  await spawn(path7za, debug7zArgs(\"x\").concat(archiveName, `-o${tempUnpackDir}`), {\n    cwd: cachePath,\n  })\n\n  await BluebirdPromise.all([\n    rename(tempUnpackDir, dirPath)\n      .catch(e => {\n        console.warn(`Cannot move downloaded ${name} into final location (another process downloaded faster?): ${e}`)\n      }),\n    unlink(archiveName),\n  ])\n\n  debug(`${name}} downloaded to ${dirPath}`)\n  return dirPath\n}"
  ]
}
